var SMI_ProductCard=function(){"use strict";class SMI_ProductCard{options={card:".smi-product-card",thumbnail:".smi-product-card__thumbnail",variants:{wrapper:".smi-variants",item:".smi-variants__item"}};constructor(_options={}){this.options={...this.options,..._options};this.handleVariantClick();this.handleAddToCart()}handleVariantClick(){const variants=document.querySelectorAll(this.options.variants.wrapper);const activeClass=this.options.variants.item.replace(".","")+"--active";variants.forEach((variant=>{const items=variant.querySelectorAll(this.options.variants.item);items.forEach((item=>{item.addEventListener("click",(e=>{const activedItem=variant.querySelector(`${this.options.variants.item}.${activeClass}`);if(activedItem){activedItem.classList.remove(activeClass)}item.classList.add(activeClass);const mediaUrl=item.dataset.mediaUrl;if(mediaUrl){const parent=variant.closest(this.options.card);const firstImage=parent.querySelector(`${this.options.thumbnail} img:nth-child(1)`);if(firstImage){firstImage.setAttribute("src",mediaUrl)}}const dataId=item.getAttribute("data-id");if(dataId){const cartParent=item.closest(".smi-product-card");const aItems=cartParent.querySelectorAll("a");if(aItems.length){aItems.forEach((aItem=>{const _hrefFull=aItem.getAttribute("href");const _href=_hrefFull.split("?")[0];aItem.setAttribute("href",`${_href}?variant=${dataId}`)}))}}}))}))}))}handleAddToCart(){const buttons=document.querySelectorAll(".smi-button-cart._cart_now a");if(buttons.length){buttons.forEach((item=>{item.addEventListener("click",(e=>{e.preventDefault();const cartObj=document.querySelector("cart-notification")||document.querySelector("cart-drawer");const variantId=item.getAttribute("data-id");item.classList.add("smi-cart-adding");const textOrigin=item.getAttribute("data-text-add-cart");const textAdded=item.getAttribute("data-text-added");const textFailed=item.getAttribute("data-text-failed");const textEl=item.querySelector(".smi-cart-text");const cartType=window.smiObject?window.smiObject.cartType:"page";let sectionsPayload=this.getSectionsToRender().map((section=>section.section));if(cartObj){let _sectionsPayload=cartObj.getSectionsToRender().map((section=>section.id));sectionsPayload=[...sectionsPayload,..._sectionsPayload]}console.log(sectionsPayload);let formData={quantity:1,id:parseInt(variantId),sections:sectionsPayload,sections_url:window.location.pathname};fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(formData)}).then((response=>response.json())).then((data=>{let isError=false;if(data?.status==422||data?.message==="Cart Error"){isError=true;textEl.innerText=textFailed}else{textEl.innerText=textAdded}const textTimer=setTimeout((()=>{textEl.innerText=textOrigin;clearTimeout(textTimer)}),2e3);if(!isError){const sectionRender=this.getSectionsToRender();sectionRender.forEach((section=>{const _sectionEl=document.getElementById(section.id);if(_sectionEl){const _elementToReplace=_sectionEl.querySelector(section.selector);let elementToReplace=null;if(_elementToReplace){elementToReplace=_elementToReplace}else{elementToReplace=_sectionEl}if(elementToReplace){elementToReplace.innerHTML=this.getSectionInnerHTML(data.sections[section.section],section.selector);if(typeof SMI_CartDrawer==="function"&&cartType==="drawer"){setTimeout((()=>{const drawerObj=new SMI_CartDrawer(".smi-cart-drawer-1");drawerObj.handleToggle();drawerObj.openDrawer()}),150)}else{window.location.href=window.smiObject.routes.cart_url}}}}));if(cartObj){if(typeof cartObj["renderContents"]==="function"){cartObj.renderContents(data)}}else{if(typeof SMI_CartDrawer!=="function"&&window.smiObject){window.location.href=window.smiObject.routes.cart_url}}}})).finally((()=>{item.classList.remove("smi-cart-adding");if(cartObj&&cartObj.classList.contains("is-empty"))cartObj.classList.remove("is-empty")}))}))}))}}getSectionsToRender(){const drawerCart=document.getElementById("smi-drawer-items");const res=[{id:"smi-cart-button",section:"smi-cart-icon-bubble",selector:".shopify-section"}];if(drawerCart){res.push({id:"shopify-section-"+drawerCart.dataset.id,section:drawerCart.dataset.id,selector:".smi-drawer-items_w"})}return res}getSectionInnerHTML(html,selector){return(new DOMParser).parseFromString(html,"text/html").querySelector(selector).innerHTML}}return SMI_ProductCard}();(function(){if(Shopify.designMode){new SMI_ProductCard}else{window.addEventListener("DOMContentLoaded",(event=>{new SMI_ProductCard}))}})();